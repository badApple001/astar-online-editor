window.es={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();var astar,__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},__read=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},__spread=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t};!function(t){var e=function(){function t(){}return t.Remove=function(t,e){var r=t.indexOf(e);-1!=r&&t.splice(r,1)},t.Add=function(t,e){-1==t.indexOf(e)&&t.push(e)},t}();t.ArrayUtils=e}(astar||(astar={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.FromCoord=function(e){return new t(e.x,e.y)},t.prototype.Distance=function(e){return t.Distance(this,e)},t.Distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t}();t.Coord=e}(astar||(astar={})),function(t){var e=function(){function t(){}return Object.defineProperty(t,"outerRadius",{get:function(){return t._outerRadius},set:function(e){isNaN(e)||null==e||null==e||"number"!=typeof e||e==t._outerRadius||(t._outerRadius=e,t.innerRadius=e*t._ratio,t._nhDiv4=e/2,t._shareCorners=t.GetCorners())},enumerable:!0,configurable:!0}),t.ShareCorners=function(){return t._shareCorners},t.GetCorners=function(){var e=t.outerRadius,r=t.innerRadius;return[0,e,r,.5*e,r,-.5*e,0,-e,-r,-.5*e,-r,.5*e,0,e]},t.GetWorldPointByPixel=function(e,r){var n=e+t.innerRadius,o=r+t.outerRadius,i=Math.floor(o/t._nhDiv4),a=Math.floor(i/3),s=Math.floor((n-a%2*t.innerRadius)/t.innerRadius/2);if(!t.PtInHexagon(s,a,e,r)){if(t.PtInHexagon(s,a-1,e,r))return[s,a-1];if(t.PtInHexagon(s+1,a,e,r))return[s+1,a];if(t.PtInHexagon(s-1,a-1,e,r))return[s-1,a-1];if(t.PtInHexagon(s+1,a-1,e,r))return[s+1,a-1]}return[s,a]},t.PtInHexagon=function(e,r,n,o){var i=t.GetPixelByWorldPoint(e,r),a=Math.abs(n-i[0]),s=Math.abs(o-i[1]);return!(s>=t.outerRadius||a>=t.innerRadius)&&t.outerRadius-s>a/t._proportion},t.GetPixelByWorldPoint=function(e,r){return[(e+r%2*.5)*t.innerRadius*2,1.5*r*t.outerRadius]},t._ratio=.5*Math.sqrt(3),t._outerRadius=100,t._proportion=Math.sqrt(3),t}();t.HexagonUtils=e}(astar||(astar={})),function(t){var e;!function(t){t[t.Final=1]="Final",t[t.Step=2]="Step"}(e=t.VisualStepType||(t.VisualStepType={}));var r=function(){function e(e){this.openList=[],this.roundList=[],this.trackList=[],this.closeSet={},this.openSet={},this.mapData=e,t.HexagonUtils.outerRadius=e.outerRadius;for(var r=e.roadDataArr,n=this.currentMap=[],o=0;o<r.length;o++){n[o]=[];for(var i=0;i<r[o].length;i++)n[o][i]=new t.RoadNode(i,o,r[o][i])}}return e.prototype.AddClosed=function(t){this.closeSet[t.key]=!0,this.RemoveOpen(t)},e.prototype.IsClosed=function(t){return this.closeSet[t.key]},e.prototype.AddOpen=function(e){this.openSet[e.key]=!0,this.closeSet[e.key]=!1,t.ArrayUtils.Add(this.openList,e)},e.prototype.IsOpened=function(t){return this.openSet[t.key]},e.prototype.RemoveOpen=function(e){this.openSet[e.key]=!1,t.ArrayUtils.Remove(this.openList,e)},e.prototype.GetMinCostNode=function(t){var e,r,n=t[0];try{for(var o=__values(t),i=o.next();!i.done;i=o.next()){var a=i.value;a.F<n.F&&(n=a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},e.prototype.GetRoadNodeByPosition=function(t,e){if(e>=0&&e<this.currentMap.length){var r=this.currentMap[e];if(t>=0&&t<r.length)return r[t]}return null},e}();t.Seeker=r;var n=[[-1,0],[0,-1],[1,-1],[1,0],[1,1],[0,1]],o=[[-1,0],[-1,-1],[0,-1],[1,0],[0,1],[-1,1]],i=function(r){function i(t){return r.call(this,t)||this}return __extends(i,r),i.prototype.CheckValid=function(e,r){return this.mapData&&0!=this.currentMap.length?e&&r?r.type!=t.RoadType.Obstacles||(t.LogUtils.Warn("终点不可到达!!",e,r),!1):(t.LogUtils.Warn("起点和终点不能为null!!",e,r),!1):(t.LogUtils.Warn("地图数据为空!!"),!1)},i.prototype.GetRoundNodeArray=function(e,r,i){var a,s,u=this.roundList;u.length=0;var l=e.y%2==0?o:n;try{for(var c=__values(l),h=c.next();!h.done;h=c.next()){var p=h.value,d=this.currentMap[p[1]+e.y];if(d){var f=d[p[0]+e.x];f&&f.type==t.RoadType.Road&&!this.IsClosed(f)&&(f.CalcCost(r,i),u.push(f))}}}catch(t){a={error:t}}finally{try{h&&!h.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}return u},i.prototype.SeekPathByPixel=function(t,e){var r=this.GetRoadNodeByPosition(t.x,t.y),n=this.GetRoadNodeByPosition(e.x,e.y);return this.SeekPath(r,n)},i.prototype.SeekPath=function(t,e){var r,n,o,i,a=this.openList,s=this.roundList;if(this.closeSet={},this.openSet={},a.length=0,!this.CheckValid(t,e))return a;for(this.AddOpen(t);0!=a.length&&(o=this.GetMinCostNode(a))!=e;){this.AddClosed(o),this.GetRoundNodeArray(o,t,e);try{for(var u=__values(s),l=u.next();!l.done;l=u.next()){var c=l.value;i=o.G+o.Distance(c),(!this.IsOpened(c)||i<c.G)&&(c.G=i,c.parent=o,this.AddOpen(c))}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}return this.TrackPath(e),this.trackList},i.prototype.TrackPath=function(t){var e,r,n,o,i,a,s=this.trackList;for(s.length=0;null!=t.parent;t=t.parent)s.push(t);s.push(t),s.reverse();for(var u=1;u<s.length-1;u++)if(o=s[u-1],i=s[u],a=s[u+1],o.y!=i.y||i.y!=a.y){if(e=2*(i.y%2+2*i.x)-o.y%2-2*o.x,r=2*i.y-o.y,a.y%2+2*a.x==e&&a.y==r){for(n=u+1;n<s.length-1&&(o=s[n-1],i=s[n],a=s[n+1],e=2*(i.y%2+2*i.x)-o.y%2-2*o.x,r=2*i.y-o.y,a.y%2+2*a.x==e&&a.y==r);n++);s.splice(u,n-u--)}}else s.splice(u--,1);return s},i.prototype.SeekPathNear=function(t,e){return this.trackList},i.prototype.VisualSeekPathEveryStep=function(t,r,n,o){var i,a,s=this,u=this.openList,l=this.roundList;(this.closeSet={},this.openSet={},u.length=0,o=o||100,this.CheckValid(t,r))&&(this.AddOpen(t),Laya.timer.clearAll(this),Laya.timer.loop(o,this,function(){var o,c;if(0!=u.length){if((i=s.GetMinCostNode(u))==r)return Laya.timer.clearAll(s),s.TrackPath(r),void n.method.call(n.caller,e.Final,s.trackList);s.AddClosed(i),s.GetRoundNodeArray(i,t,r);try{for(var h=__values(l),p=h.next();!p.done;p=h.next()){var d=p.value;a=i.G+i.Distance(d),(!s.IsOpened(d)||a<d.G)&&(d.G=a,d.parent=i,s.AddOpen(d))}}catch(t){o={error:t}}finally{try{p&&!p.done&&(c=h.return)&&c.call(h)}finally{if(o)throw o.error}}n.method.call(n.caller,e.Step,i,l)}else Laya.timer.clearAll(s)}))},i}(r);t.HoneycombSeeker=i}(astar||(astar={})),function(t){var e=function(){function t(){}return t.Info=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];console.log.apply(console,__spread(["%c"+t,"color:#eeee33;background:#000000;padding:3px 6px;"],e))},t.Warn=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];console.log.apply(console,__spread(["%c"+t,"color:#ffff33;background:#000000;padding:3px 6px;"],e))},t.Error=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];console.log.apply(console,__spread(["%c"+t,"color:#ff3333;background:#000000;padding:3px 6px;"],e))},t}();t.LogUtils=e}(astar||(astar={})),function(t){!function(t){t[t.Obstacles=0]="Obstacles",t[t.Road=1]="Road"}(t.RoadType||(t.RoadType={}));var e=function(){return function(){this.timestamp=0,this.mapWidth=0,this.mapHeight=0,this.outerRadius=30,this.k=.5,this.roadDataArr=[]}}();t.MapData=e}(astar||(astar={})),function(t){var e=function(e){function r(t,r,n){var o=e.call(this)||this;return o.G=0,o.H=0,o.parent=null,o.x=t,o.y=r,o.type=n,o}return __extends(r,e),Object.defineProperty(r.prototype,"F",{get:function(){return r.k*this.G+(1-r.k)*this.H},enumerable:!0,configurable:!0}),r.prototype.CalcCost=function(t,e){this.G=this.Distance(t),this.H=this.Distance(e)},Object.defineProperty(r.prototype,"position",{get:function(){return t.HexagonUtils.GetPixelByWorldPoint(this.x,this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"key",{get:function(){return this.x<<12|this.y},enumerable:!0,configurable:!0}),r.key2Coord=function(e){return new t.Coord(e>>12&4095,4095&e)},Object.defineProperty(r.prototype,"gridX",{get:function(){return 2*this.x+this.y%2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gridY",{get:function(){return this.y},enumerable:!0,configurable:!0}),r.prototype.Distance=function(t){return Math.abs(t.gridX-this.gridX)+Math.abs(t.gridY-this.gridY)},r.k=.5,r}(t.Coord);t.RoadNode=e}(astar||(astar={}));