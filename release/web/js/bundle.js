!function(){"use strict";class t{constructor(t,e,a){e=e||{x:Laya.stage.width/2,y:Laya.stage.height/2},a=a||3e3;let i=Laya.Pool.createByClass(Laya.Label),s=Laya.Pool.createByClass(Laya.Image);s.skin="comp/label.png",s.x=e.x,s.y=e.y,s.addChild(i),s.anchorX=s.anchorY=.5,i.centerX=i.centerY=0,i.fontSize=32,i.text=t,s.width=i.get_width()+20,s.height=i.get_height()+4,Laya.stage.addChild(s),this.bubble=s,Laya.Tween.to(s,{y:s.y-200},a,Laya.Ease.circOut),Laya.timer.once(a,this,this.Shutdown)}Shutdown(){Laya.Pool.recoverByClass(this.bubble.getChildAt(0)),Laya.Pool.recoverByClass(this.bubble),this.bubble.removeChildren(),this.bubble.removeSelf()}}var e=astar.Coord,a=astar.HoneycombSeeker,i=astar.RoadNode,s=astar.VisualStepType;class o{constructor(t){this.index=0,this._root=t,this._gfx=new Laya.Sprite,this._root.addChild(this._gfx),this._gfx.visible=!1,this._actor=new Laya.Sprite,this._actor.texture=Laya.loader.getRes("comp/actor.png"),this._actor.pivot(.5*this._actor.width,this._actor.height),this._root.addChild(this._actor),this._actor.visible=!1}Move(t,e,i){if(console.log("move..."),!t)return void alert("地图数据为null!!!\n请生成地图后重试");if(!(e&&e.length&&i&&i.length))return void alert("你需要添加起点和终点位置");let s=new a(t),o=s.GetRoadNodeByPosition(e[0],e[1]),l=s.GetRoadNodeByPosition(i[0],i[1]);if(!l||!o)return void alert(`开始节点和结束节点位置不对\nstartPoint:${e[0]},${e[1]}\ntargetPoint:${i[0]},${i[1]}\nmapData:${t.roadDataArr[0].length},${t.roadDataArr.length}`);let h=s.SeekPath(o,l);this._actor.visible=!0;let n=h[0].position;this._actor.pos(n[0],n[1]),this.paths=h,this.index=1,console.log(h),Laya.timer.frameLoop(1,this,this.Update)}Update(){let a=this.paths[this.index].position,i=this._actor,s=a[0]-i.x,o=a[1]-i.y,l=e.Distance({x:i.x,y:i.y},{x:a[0],y:a[1]}),h=s/l,n=o/l,r=i.x+60*h*Laya.updateTimer.delta/1e3,d=i.y+60*n*Laya.updateTimer.delta/1e3;(e.Distance({x:r,y:d},{x:a[0],y:a[1]})>l||l<.01)&&(this.index++,this.index>=this.paths.length&&(Laya.timer.clear(this,this.Update),new t("到达终点"))),this._actor.pos(r,d)}Simulation(t,e,i){if(console.log("simulation..."),this._startPoint=e,this._targetPoint=i,!t)return void alert("地图数据为null!!!\n请生成地图后重试");if(!(e&&e.length&&i&&i.length))return void alert("你需要添加起点和终点位置");let s=new a(t),o=s.GetRoadNodeByPosition(e[0],e[1]),l=s.GetRoadNodeByPosition(i[0],i[1]);l&&o?s.VisualSeekPathEveryStep(o,l,{method:this.VisualStep,caller:this},50):alert(`开始节点和结束节点位置不对\nstartPoint:${e[0]},${e[1]}\ntargetPoint:${i[0]},${i[1]}\nmapData:${t.roadDataArr[0].length},${t.roadDataArr.length}`)}VisualStep(t,a,o){if(a instanceof i){if(this.lastRound&&this.lastRound.length>0)for(let t=0;t<this.lastRound.length;t++){let e=this.lastRound[t];e.x==this._targetPoint[0]&&e.y==this._targetPoint[1]||this.editor.RemoveObstacles(e.x,e.y)}if(this.lastRound=[],o&&o.length>0)for(let t=0;t<o.length;t++){let a=o[t];this.lastRound.push(e.FromCoord(a)),this.editor.AddRound(a.x,a.y)}this.lastNode&&(this.editor.RemoveObstacles(this.lastNode.x,this.lastNode.y),this.lastNode=null),a.x==this._startPoint[0]&&a.y==this._startPoint[1]||(this.lastNode=e.FromCoord(a),this.editor.AddCurrent(a.x,a.y))}else if(t==s.Final){if(this.lastNode&&(this.editor.RemoveObstacles(this.lastNode.x,this.lastNode.y),this.lastNode=null),this.lastRound&&this.lastRound.length>0)for(let t=0;t<this.lastRound.length;t++){let e=this.lastRound[t];e.x==this._targetPoint[0]&&e.y==this._targetPoint[1]||this.editor.RemoveObstacles(e.x,e.y)}this.lastRound=[];let t=a;this._gfx.visible=!0;let e=this._gfx.graphics,i=[];for(let e of t)i.push(...e.position);e.clear(!0),e.drawLines(0,0,i,"#ff0000",2)}}}class l{static EnableDropFile(t){t.once=!1;const e=document;e.addEventListener("dragenter",function(t){t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("drop",function(e){e.preventDefault();var a=e.dataTransfer.files[0],i=a.type;if(i.indexOf("image")>-1){var s=URL.createObjectURL(a),o=new Image;o.src=s;var l=a.name;o.addEventListener("load",()=>{let e=new Laya.Texture2D;e.loadImageSource(o),setTimeout(()=>{let a=Laya.Texture.create(e,0,0,e.width,e.height);Laya.loader.cacheRes(l,a),Laya.Loader.loadedMap[l]=a,t&&t.runWith(l)},100)})}else if(i.indexOf("json")>-1){console.log("文件："+a.name);var h=new FileReader;h.onload=(e=>{"string"==typeof h.result&&t.runWith(JSON.parse(h.result))}),h.readAsText(a)}else console.log("文件："+a.name)},!1)}static DownloadTextFile(t,e){const a=document.createElement("a");a.download=e,a.style.display="none";const i=new Blob([t]);a.href=URL.createObjectURL(i),document.body.appendChild(a),a.click(),document.body.removeChild(a)}static DownloadZip(t,e){window.open(t)}}class h{static Info(t,...e){console.log(`%c${t}`,"color:#eeee33;background:#000000;padding:3px 6px;",...e)}static Warn(t,...e){console.log(`%c${t}`,"color:#ffff33;background:#000000;padding:3px 6px;",...e)}static Error(t,...e){console.log(`%c${t}`,"color:#ff3333;background:#000000;padding:3px 6px;",...e)}}var n,r=Laya.Scene,d=Laya.ClassUtils.regClass;!function(t){class e extends r{constructor(){super()}createChildren(){super.createChildren(),this.createView(e.uiView)}}e.uiView={type:"Scene",props:{width:1280,height:720},compId:2,child:[{type:"Image",props:{var:"img_desktopUI",top:0,skin:"bg/bg2.jpg",right:0,left:0,bottom:0},compId:68},{type:"Panel",props:{var:"scrollView",top:0,right:0,left:0,bottom:0},compId:11,child:[{type:"Image",props:{var:"bg",alpha:1},compId:6}]},{type:"Image",props:{var:"turnRightTop",top:-4,skin:"comp/triangleIcon.png",scaleY:.3,scaleX:.3,right:-7},compId:13},{type:"Image",props:{var:"turnLeftTop",top:-4,skin:"comp/triangleIcon.png",scaleY:.3,scaleX:-.3,left:53},compId:14},{type:"Image",props:{y:724,var:"turnLeftBottom",skin:"comp/triangleIcon.png",scaleY:-.3,scaleX:-.3,left:53},compId:15},{type:"Image",props:{y:724,var:"turnRightBottom",skin:"comp/triangleIcon.png",scaleY:-.3,scaleX:.3,right:-7},compId:16},{type:"TextInput",props:{y:0,x:53,width:78,var:"gridSize",text:"30",skin:"comp/textinput.png",height:26,fontSize:20,bold:!0,sizeGrid:"9,0,10,0"},compId:26},{type:"Box",props:{y:0,x:133,var:"topMenu",space:4,align:"top"},compId:19,child:[{type:"Button",props:{y:0,x:4,width:84,var:"btn_draw",skin:"comp/button.png",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"生成地图",height:26},compId:18},{type:"Button",props:{y:0,x:4,width:84,var:"btn_addAbstacles",skin:"comp/button.png",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"添加障碍",height:26},compId:33},{type:"Button",props:{y:0,x:176,width:84,var:"btn_removeAbstacles",skin:"comp/button.png",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"移除障碍",height:26},compId:34},{type:"Button",props:{y:0,x:176,width:134,var:"btn_downloadMapdata",skin:"comp/button.png",sizeGrid:"14,20,14,16",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"下载地图数据",height:26},compId:36},{type:"Button",props:{y:0,x:264,width:96,var:"btn_addStart",skin:"comp/button.png",sizeGrid:"14,20,14,16",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"添加起点",height:26},compId:37},{type:"Button",props:{y:0,x:264,width:96,var:"btn_addTarget",skin:"comp/button.png",sizeGrid:"14,20,14,16",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"添加终点",height:26},compId:38},{type:"Button",props:{y:0,x:402,width:96,var:"btn_findPath",skin:"comp/button.png",sizeGrid:"14,20,14,16",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"模拟寻路",height:26},compId:39},{type:"Button",props:{y:0,x:1007,width:130,var:"btn_visualStep",skin:"comp/button.png",sizeGrid:"14,20,14,16",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"查看寻路细节",height:26},compId:51},{type:"Box",props:{y:0,x:789,width:223,scaleY:.5,scaleX:.5,renderType:"render",height:100},compId:46,child:[{type:"HSlider",props:{y:50,width:209,var:"slider_k",value:50,tick:1,skin:"comp/hslider.png",showLabel:!1,min:0,max:100,height:72,centerX:0,allowClickBack:!0},compId:45},{type:"Label",props:{y:0,x:7,var:"text_b",text:"BFS",fontSize:30,alpha:1},compId:47},{type:"Label",props:{y:0,var:"text_a",text:"A",fontSize:30,centerX:0},compId:48},{type:"Label",props:{y:0,var:"text_d",text:"Dijkstra",right:-43,fontSize:30},compId:49}]}]},{type:"Box",props:{y:694,x:133,width:1137,var:"bottomMenu",space:4,height:26,align:"top"},compId:53,child:[{type:"Button",props:{y:0,x:4,width:84,var:"btn_downAstartLib",skin:"comp/button.png",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"下载A*库",height:26},compId:54},{type:"Button",props:{y:0,x:4,width:84,var:"btn_csdn",skin:"comp/button.png",labelSize:20,labelFont:"Arial",labelColors:"#fefefe,#ffffff,#fefefe",label:"使用教程",height:26},compId:67}]},{type:"Label",props:{var:"text_newPlayerTip",valign:"middle",text:"请拖入背景图片\\n或者拖入地图JSON",strokeColor:"#4081b9",stroke:8,leading:8,fontSize:64,font:"Helvetica",color:"#8abee7",centerY:0,centerX:0,cacheAs:"bitmap",bold:!0,align:"center"},compId:40}],loadList:["bg/bg2.jpg","comp/triangleIcon.png","comp/textinput.png","comp/button.png","comp/hslider.png"],loadList3D:[]},t.MapEditorUI=e,d("ui.MapEditorUI",e)}(n||(n={}));var g,p=astar.RoadNode,c=astar.MapData,f=astar.RoadType,b=astar.HexagonUtils;!function(t){t[t.None=0]="None",t[t.AddObstacles=1]="AddObstacles",t[t.RemoveObstacles=2]="RemoveObstacles",t[t.AddStart=3]="AddStart",t[t.AddTarget=4]="AddTarget"}(g||(g={}));class u extends n.MapEditorUI{constructor(){super(...arguments),this._inited=!1,this._behavior=g.None,this._startPoint=[],this._targetPoint=[],this._hexagonMap=[],this._enableTouchMap=!1}onOpened(e){super.onOpened(e);if(this.turnLeftBottom.y=Laya.stage.height-0,this.turnRightBottom.y=Laya.stage.height-0,this.bottomMenu.y=Laya.stage.height-0-this.bottomMenu.height,!this._text_declaration){let t=this._text_declaration=new Laya.Label;t.fontSize=20,t.color="#ffffff",t.wordWrap=!0,t.top=100,t.right=0,t.width=200,this.addChild(t)}if(!this._gfx){let t=new Laya.Sprite;this.addChild(t),this._gfx=t.graphics}if(!this._inited){let e,a;this._inited=!0,this.scrollView.hScrollBarSkin="",this.scrollView.vScrollBarSkin="",this.scrollView.mouseEnabled=!1,Laya.timer.frameLoop(1,this,this.Update),this.on(Laya.Event.MOUSE_DOWN,this,this.MouseDown),this.on(Laya.Event.MOUSE_MOVE,this,this.MouseMove),this.on(Laya.Event.MOUSE_UP,this,this.MouseUp),Laya.stage.on(Laya.Event.KEY_DOWN,this,this.KeyDown),Laya.stage.on(Laya.Event.KEY_PRESS,this,this.KeyDown),Laya.stage.on(Laya.Event.KEY_UP,this,this.KeyUp),this.btn_addAbstacles.on(Laya.Event.CLICK,this,()=>{0!=this._hexagonMap.length?(this.btn_removeAbstacles.gray=!1,this.btn_addAbstacles.gray=!0,this._behavior=g.AddObstacles,new t("alt键 + 拖动鼠标\n添加障碍点",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3)):alert("你需要先点击生成地图")}),this.btn_removeAbstacles.on(Laya.Event.CLICK,this,()=>{0!=this._hexagonMap.length?(this.btn_removeAbstacles.gray=!0,this.btn_addAbstacles.gray=!1,this._behavior=g.RemoveObstacles,new t("alt键 + 拖动鼠标\n移除障碍点",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3)):alert("你需要先点击生成地图")}),this.btn_addStart.on(Laya.Event.CLICK,this,()=>{0!=this._hexagonMap.length?"添加起点"==this.btn_addStart.text.text?(this.btn_addStart.text.text="移除起点",this._behavior=g.AddStart,this.btn_addAbstacles.gray=!0,this.btn_removeAbstacles.gray=!0,new t("alt键 + 点击\n添加起点",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3)):(this.btn_addStart.text.text="添加起点",this._behavior=g.None,this.btn_addAbstacles.gray=!1,this.btn_removeAbstacles.gray=!1,this._startPoint.length>0&&(this.RemoveObstacles(this._startPoint[0],this._startPoint[1]),this._startPoint.length=0,new t("起点已移除...",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3))):alert("你需要先点击生成地图")}),this.btn_addTarget.on(Laya.Event.CLICK,this,()=>{0!=this._hexagonMap.length?"添加终点"==this.btn_addTarget.text.text?(this.btn_addTarget.text.text="移除终点",this._behavior=g.AddTarget,this.btn_addAbstacles.gray=!0,this.btn_removeAbstacles.gray=!0,new t("alt键 + 点击\n添加终点",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3)):(this.btn_addTarget.text.text="添加终点",this._behavior=g.None,this.btn_addAbstacles.gray=!1,this.btn_removeAbstacles.gray=!1,this._targetPoint.length>0&&(this.RemoveObstacles(this._targetPoint[0],this._targetPoint[1]),this._targetPoint.length=0,new t("终点已移除...",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3))):alert("你需要先点击生成地图")}),this.btn_findPath.on(Laya.Event.CLICK,this,()=>{this.findPathHandler&&this.findPathHandler.runWith([this.CreateMapData(),this._startPoint,this._targetPoint])}),this.btn_visualStep.on(Laya.Event.CLICK,this,()=>{this.visualStepHandler&&this.visualStepHandler.runWith([this.CreateMapData(),this._startPoint,this._targetPoint])}),this.btn_downloadMapdata.on(Laya.Event.CLICK,this,this.DownloadMapData),this.turnRightTop.on(Laya.Event.CLICK,this,()=>{this._enableTouchMap||(this.scrollView.hScrollBar.value=.5*(this.bg.width-Laya.stage.width),this.scrollView.vScrollBar.value=0)}),this.turnRightBottom.on(Laya.Event.CLICK,this,()=>{this._enableTouchMap||(this.scrollView.hScrollBar.value=.5*(this.bg.width-Laya.stage.width),this.scrollView.vScrollBar.value=.5*(this.bg.height-Laya.stage.height))}),this.turnLeftTop.on(Laya.Event.CLICK,this,()=>{this._enableTouchMap||(this.scrollView.hScrollBar.value=0,this.scrollView.vScrollBar.value=0)}),this.turnLeftBottom.on(Laya.Event.CLICK,this,()=>{this._enableTouchMap||(this.scrollView.hScrollBar.value=0,this.scrollView.vScrollBar.value=.5*(this.bg.height-Laya.stage.height))}),this.btn_downAstartLib.on(Laya.Event.CLICK,this,()=>{l.DownloadZip("https://github.com/badApple001/astar-online-editor/raw/main/AStartSource/bin/astar_lib.zip","astar_lib.zip"),h.Info("下载 A*库")}),this.btn_csdn.on(Laya.Event.CLICK,this,()=>{window.open("https://blog.csdn.net/qq_39162566/article/details/126552533"),h.Info("前往csdn博客")}),this.btn_draw.clickHandler=Laya.Handler.create(this,this.ClickDrawGrid,void 0,!1),this._bgGridSprite=new Laya.Sprite,this.bg.addChild(this._bgGridSprite),this.slider_k.changeHandler=Laya.Handler.create(this,t=>{let e=Math.floor(t/100*10)/10;p.k=e,console.log("K: ",e),this.text_a.alpha=.5==e?1:.5*Math.abs(.5-e),this.text_b.alpha=Math.max(.2,Math.abs(1-e)),this.text_d.alpha=Math.max(.2,Math.abs(e))},void 0,!1);for(let t=1;t<this.topMenu.numChildren;t++)e=this.topMenu.getChildAt(t-1),(a=this.topMenu.getChildAt(t)).x=e.x+e.width+4;for(let t=1;t<this.bottomMenu.numChildren;t++)e=this.bottomMenu.getChildAt(t-1),(a=this.bottomMenu.getChildAt(t)).x=e.x+e.width+4}}onClosed(t){super.onClosed(t),Laya.timer.clear(this,this.Update)}CreateMapData(){if(0==this._hexagonMap.length)return alert("当前地图数据为null\n需要先点击生成地图"),null;let t=new c;t.timestamp=Date.now(),t.mapWidth=this.bg.width,t.mapHeight=this.bg.height,t.outerRadius=b.outerRadius,t.k=p.k;let e=[];for(let t=0;t<this._hexagonMap.length;t++){e[t]=[];for(let a=0;a<this._hexagonMap[t].length;a++)e[t][a]="#fefe00"==this._hexagonMap[t][a].fillColor?f.Obstacles:f.Road}return t.roadDataArr=e,t}DownloadMapData(){let t=this.CreateMapData();if(t){let e=JSON.stringify(t);l.DownloadTextFile(e,"map_data.json")}}ClickDrawGrid(e){if(!this.bg.skin||""==this.bg.skin)return void alert("生成地图前,必须拖入背景图片文件");let a=parseInt(this.gridSize.text,10);if(isNaN(a))return void alert("格子数值不为number类型");b.outerRadius=a,console.log("hexmap outer radius: ",b.outerRadius);let i=this._bgGridSprite.graphics;this._hexagonMap=[],i.clear(!0);let s=Math.floor(this.bg.width/2/b.innerRadius)+1,o=Math.floor(this.bg.height/3*2/b.outerRadius)+1;if(console.log(`grid count: ${s} x ${o}`),s>4096||o>4096){if(alert("行数或者列数超过了4096，请调整格子大小！！！"),o>4096){o=4096;let t=this.bg.height/3*2/4095;b.outerRadius=t,s=Math.floor(this.bg.width/2/b.innerRadius)+1}if(s>4096){s=4096;let t=this.bg.width/2/4095;b.outerRadius=Math.floor(t/(.5*Math.sqrt(3))),o=Math.floor(this.bg.height/3*2/b.outerRadius)+1}new t(`已为你自动调整格子大小!! \n当前格子数量: ${s}x${o}`,{x:Laya.stage.width,y:Laya.stage.height/2},4e3)}for(let t=0;t<o;t++){this._hexagonMap[t]=[];for(let e=0;e<s;e++)this._hexagonMap[t][e]=i.drawPoly((e+t%2*.5)*b.innerRadius*2,t*b.outerRadius/2*3,b.ShareCorners(),void 0,"#fefe00",2)}}LoadMapByJson(t){this.text_newPlayerTip.visible=!1,b.outerRadius=t.outerRadius,p.k=t.k,console.log("hexmap outer radius: ",b.outerRadius);let e=this._bgGridSprite.graphics;this._hexagonMap=[],e.clear(!0);let a=t.roadDataArr[0].length,i=t.roadDataArr.length;for(let s=0;s<i;s++){this._hexagonMap[s]=[];for(let i=0;i<a;i++)this._hexagonMap[s][i]=e.drawPoly((i+s%2*.5)*b.innerRadius*2,s*b.outerRadius/2*3,b.ShareCorners(),t.roadDataArr[s][i]==f.Road?void 0:"#fefe00","#fefe00",2)}}KeyDown(t){t.keyCode==Laya.Keyboard.SPACE&&(this._enableTouchMap=!0,this.scrollView.mouseEnabled=!0),t.altKey&&(this.bg.alpha=.8)}KeyUp(t){t.keyCode==Laya.Keyboard.SPACE&&(this._enableTouchMap=!1,this.scrollView.mouseEnabled=!1),t.altKey||(this._gfx.clear(!0),this.bg.alpha=1,this.topMenu.visible=!0,this.gridSize.visible=this.topMenu.visible,this._text_declaration.visible=!0)}Lock(t){if(this._enableTouchMap)return;this._gfx.clear(!0),this._gfx.drawLine(0,t.stageY,Laya.stage.width,t.stageY,"#ff0000",2),this._gfx.drawLine(t.stageX,0,t.stageX,Laya.stage.height,"#ff0000",2),this.topMenu.visible=t.stageY>40,this.gridSize.visible=this.topMenu.visible,this._text_declaration.visible=t.stageX<this._text_declaration.x||t.stageY>this._text_declaration.y+this._text_declaration.height;let e=b.GetWorldPointByPixel(this._mouseMapX,this._mouseMapY);switch(this._behavior){case g.AddObstacles:this.AddObstacles(e[0],e[1]);break;case g.AddStart:this.AddStart(e[0],e[1]);break;case g.AddTarget:this.AddTarget(e[0],e[1]);break;case g.RemoveObstacles:this.RemoveObstacles(e[0],e[1]);break;default:console.log(e)}}AddCurrent(t,e){if(this._hexagonMap.length>0){let a=this._hexagonMap[e];if(a){let e=a[t];e&&(e.fillColor="#00ff33")}}}AddRound(t,e){if((t!=this._targetPoint[0]||e!=this._targetPoint[1])&&this._hexagonMap.length>0){let a=this._hexagonMap[e];if(a){let e=a[t];e&&(e.fillColor="#333333")}}}AddStart(e,a){if(this._startPoint.length>0&&(this.RemoveObstacles(this._startPoint[0],this._startPoint[1]),this._startPoint.length=0),this._hexagonMap.length>0){let i=this._hexagonMap[a];if(i){let s=i[e];if(s){if("#fefe00"==s.fillColor)return this._startPoint=[],void new t("起点和终点不能在障碍区!",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3);s.fillColor="#0000ff",this._startPoint=[e,a]}}}}AddTarget(e,a){if(this._targetPoint.length>0&&(this.RemoveObstacles(this._targetPoint[0],this._targetPoint[1]),this._targetPoint.length=0),this._hexagonMap.length>0){let i=this._hexagonMap[a];if(i){let s=i[e];if(s){if("#fefe00"==s.fillColor)return this._startPoint=[],void new t("起点和终点不能在障碍区!",{x:Laya.stage.width/2,y:Laya.stage.height/2},3e3);this._targetPoint=[e,a],s.fillColor="#ff00ff"}}}}AddObstacles(t,e){if(this._hexagonMap.length>0){let a=this._hexagonMap[e];if(a){let e=a[t];e&&(e.fillColor="#fefe00")}}}RemoveObstacles(t,e){if(this._hexagonMap.length>0){let a=this._hexagonMap[e];if(a){let e=a[t];e&&(e.fillColor=void 0)}}}MouseDown(t){this._mouseX=t.stageX,this._mouseY=t.stageY,this._mouseMapX=this.scrollView.hScrollBar.value+this._mouseX,this._mouseMapY=this.scrollView.vScrollBar.value+this._mouseY,t.altKey&&this.Lock(t)}MouseMove(t){this._mouseX=t.stageX,this._mouseY=t.stageY,this._mouseMapX=this.scrollView.hScrollBar.value+this._mouseX,this._mouseMapY=this.scrollView.vScrollBar.value+this._mouseY,t.altKey&&this.Lock(t)}MouseUp(t){this._mouseX=t.stageX,this._mouseY=t.stageY,this._mouseMapX=this.scrollView.hScrollBar.value+this._mouseX,this._mouseMapY=this.scrollView.vScrollBar.value+this._mouseY,this._gfx.clear(!0)}SetBg(t){this.bg.skin=t,this.img_desktopUI.parent&&this.img_desktopUI.removeSelf(),this.text_newPlayerTip.visible=!1,Laya.timer.once(100,this,this._SetBg)}_SetBg(){this.scrollView.refresh()}Update(){this._text_declaration.text=`mouse stageX: ${this.mouseX}\nmouse stageY: ${this.mouseY}\nmouse mapX: ${Math.floor(this._mouseMapX)}\nmouse mapY: ${Math.floor(this._mouseMapY)}\n[快捷键]\n[space+🖱️]: 拖动地图`}}class y{constructor(){Laya.stage.bgColor="#59b7f4",this.editor=new u,this.editor.open(),this.findpathDemp=new o(this.editor.scrollView),this.findpathDemp.editor=this.editor,this.editor.findPathHandler=Laya.Handler.create(this.findpathDemp,this.findpathDemp.Move,void 0,!1),this.editor.visualStepHandler=Laya.Handler.create(this.findpathDemp,this.findpathDemp.Simulation,void 0,!1),l.EnableDropFile(Laya.Handler.create(this,t=>{"string"==typeof t?this.editor.SetBg(t):this.editor.LoadMapByJson(t)},void 0,!1))}}class _{constructor(){}static init(){Laya.ClassUtils.regClass}}_.width=1280,_.height=720,_.scaleMode="fixedwidth",_.screenMode="horizontal",_.alignV="top",_.alignH="left",_.startScene="MapEditor.scene",_.sceneRoot="",_.debug=!1,_.stat=!1,_.physicsDebug=!1,_.exportSceneToJson=!1,_.init();new class{constructor(){window.Laya3D?Laya3D.init(_.width,_.height):Laya.init(_.width,_.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=_.scaleMode,Laya.stage.screenMode=_.screenMode,Laya.stage.alignV=_.alignV,Laya.stage.alignH=_.alignH,Laya.URL.exportSceneToJson=_.exportSceneToJson,(_.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),_.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),_.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Laya.loader.load("res/atlas/comp.atlas",Laya.Handler.create(this,()=>{new y}))}}}();